<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sunburst CSV sin conflictos</title>
  <script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
  <style>
    body { font-family: Arial; margin: 40px; background: #f4f4f4; }
    #grafico { width: 100%; max-width: 1000px; height: 700px; margin: auto; }
    textarea { display: none; }
  </style>
</head>
<body>

<h2 style="text-align:center;">Gr√°fico Sunburst desde CSV (IDs √∫nicos)</h2>

<textarea id="csvData">
PERSONA;Tipo Busqueda Selectiva;TIPO;MONTO
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;369800000.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;208507300.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;187804000.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;98148628.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;80800000.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;RETIRO;33187200.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;RETIRO;15000000.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;RETIRO;0.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;RETIRO;10000000.00
ANA MARIA RIVERA LOPEZ;DEPOSITOS EFECTIVO;RETIRO;23021096.00
ANA MARIA RIVERA LOPEZ;CAMBIARIA;REMESAS TRABAJADORES;3000000.00
ANA MARIA RIVERA LOPEZ;CATASTRO PROPIETARIOS;001-01263225;481290406.00
ANA MARIA RIVERA LOPEZ;VEHICULOS;TOYOTA 2018;217000000.00
ANA MARIA RIVERA LOPEZ;NOTARIA;VENDEDOR;182000000.00
ANA MARIA RIVERA LOPEZ;NOTARIA;COMPRADOR;284000000.00
ANA MARIA RIVERA LOPEZ;NOTARIA;OTRO;182000000.00
ANA MARIA RIVERA LOPEZ;NOTARIA;VENDEDOR;182000000.00
ANA MARIA RIVERA LOPEZ;NOTARIA;COMPRADOR;290000000.00
ANA MARIA RIVERA LOPEZ;NOTARIA;COMPRADOR;235480509.00
CARLOS ANDRES BERMUDEZ LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;24891709.00
CARLOS ANDRES BERMUDEZ LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;20040000.00
CARLOS ANDRES BERMUDEZ LOPEZ;DEPOSITOS EFECTIVO;DEPOSITO;0.00
CARLOS ANDRES BERMUDEZ LOPEZ;DEPOSITOS EFECTIVO;RETIRO;0.00
CARLOS ANDRES BERMUDEZ LOPEZ;DEPOSITOS EFECTIVO;RETIRO;2200500.00
CARLOS ANDRES BERMUDEZ LOPEZ;DEPOSITOS EFECTIVO;RETIRO;2145000.00
CARLOS ANDRES BERMUDEZ LOPEZ;CAMBIARIA;TURISMO;965500.00
CARLOS ANDRES BERMUDEZ LOPEZ;CAMBIARIA;0TROS;8197530.00
CARLOS ANDRES BERMUDEZ LOPEZ;CAMBIARIA;NEGOCIOS;31790841.00
CARLOS ANDRES BERMUDEZ LOPEZ;CAMBIARIA;SERVICIOS;1183900.00
CARLOS ANDRES BERMUDEZ LOPEZ;CAMBIARIA;VENTA RESIDENTES;224140.00
CARLOS ANDRES BERMUDEZ LOPEZ;CAMBIARIA;COMPRA DIVISA;7443880.00
CARLOS ANDRES BERMUDEZ LOPEZ;CATASTRO PROPIETARIOS;744995;75956000.00
CARLOS ANDRES BERMUDEZ LOPEZ;VEHICULOS;MAZDA 2012;35000000.00
CARLOS ANDRES BERMUDEZ LOPEZ;NOTARIA;COMPRADOR;235480509.00
FELIPE TORO VALENCIA;CAMBIARIA;COMPRA RESIDENTES;3380200.00
FELIPE TORO VALENCIA;CAMBIARIA;REMESAS TRABAJADORES;2383103.00
FELIPE TORO VALENCIA;CAMBIARIA;CAMBISTAS;13360000.00
GABRIELA VALENCIA SALAZAR;CAMBIARIA;REMESAS TRABAJADORES;3000000.00
JULIANA HERRERA VALENCIA;DEPOSITOS EFECTIVO;DEPOSITO;6500000.00
JULIANA HERRERA VALENCIA;DEPOSITOS EFECTIVO;RETIRO;0.00
JULIANA HERRERA VALENCIA;CAMBIARIA;NEGOCIOS;723000.00
JULIANA HERRERA VALENCIA;CAMBIARIA;REMESAS TRABAJADORES;28127984.00
JULIANA HERRERA VALENCIA;CAMBIARIA;DONACIONES;18556977.00
JULIANA HERRERA VALENCIA;CAMBIARIA;VENTA RESIDENTES;483743.00
JULIANA HERRERA VALENCIA;CAMBIARIA;CAMBISTAS;18884000.00
JULIANA HERRERA VALENCIA;VEHICULOS;TOYOTA 2019;175000000.00
JULIANA HERRERA VALENCIA;VEHICULOS;NISSAN 2019;91000000.00
SANTIAGO LOPEZ GARCIA;DEPOSITOS EFECTIVO;DEPOSITO;4598893.00
SANTIAGO LOPEZ GARCIA;DEPOSITOS EFECTIVO;DEPOSITO;0.00
SANTIAGO LOPEZ GARCIA;DEPOSITOS EFECTIVO;DEPOSITO;0.00
SANTIAGO LOPEZ GARCIA;DEPOSITOS EFECTIVO;RETIRO;0.00
SANTIAGO LOPEZ GARCIA;DEPOSITOS EFECTIVO;RETIRO;3365500.00
SANTIAGO LOPEZ GARCIA;DEPOSITOS EFECTIVO;RETIRO;3197720.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;TURISMO;4403000.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;COMPRA RESIDENTES;7336500.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;OTROS;3017500.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;NEGOCIOS;15337116.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;REMESAS TRABAJADORES;18283225.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;DONACIONES;11164792.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;VENTA RESIDENTES;2377500.00
SANTIAGO LOPEZ GARCIA;CAMBIARIA;CAMBISTAS;4698200.00
SANTIAGO LOPEZ GARCIA;CATASTRO PROPIETARIOS;222260;180943000.00
SANTIAGO LOPEZ GARCIA;VEHICULOS;VEHICULO 2014;0.00
</textarea>

<div id="grafico"></div>

<script>
function parseCSV(text) {
  const rows = text.trim().split("\n");
  const headers = rows.shift().split(";"); // ‚úÖ CAMBIO A ;
  return rows.map(row => {
    const values = row.split(";"); // ‚úÖ CAMBIO A ;
    return Object.fromEntries(headers.map((h, i) => [h, values[i]]));
  });
}

try {
  const data = parseCSV(document.getElementById("csvData").value);
  const ids = [], labels = [], parents = [], values = [], added = new Set();
  let idCounter = 0;

  function safeAdd(id, label, parent, value = 0) {
    if (!added.has(id)) {
      ids.push(id);
      labels.push(label);
      parents.push(parent);
      values.push(value);
      added.add(id);
    }
  }

  data.forEach(row => {
    const persona = row["PERSONA"];
    const tipoBusqueda = row["Tipo Busqueda Selectiva"];
    const tipo = row["TIPO"];
    const monto = parseFloat(String(row["MONTO"]).replace(/[$,\s]/g, ''));

    if (!persona || !tipoBusqueda || !tipo || isNaN(monto)) return;

    const idPersona = persona;
    const idBusqueda = persona + "|" + tipoBusqueda;
    const idTipo = persona + "|" + tipoBusqueda + "|" + tipo + "|" + (++idCounter);

    safeAdd(idPersona, persona, "");
    safeAdd(idBusqueda, tipoBusqueda, idPersona);
    safeAdd(idTipo, tipo, idBusqueda, monto);
  });

Plotly.newPlot("grafico", [{
  type: "sunburst",
  ids: ids,
  labels: labels,
  parents: parents,
  values: values,
  branchvalues: "remainder",
  textinfo: "label+value"  // üëà hace visibles los montos
}]);

} catch (error) {
  console.error("‚ùå Error general:", error);
}
</script>

</body>
</html>
